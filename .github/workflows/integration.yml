########################################
# 🔄 WORKFLOW REUSABLE: Date Workflow
# Ejecuta análisis de integración y validaciones básicas.
# Diseñado para ser invocado desde otros workflows.
# integration.yml
########################################

name: Reusable Date Workflow

# 🔧 Definir como workflow reusable
on:
  workflow_call:  # Permite que otros workflows lo invoquen
    # secrets:
    #   SONAR_TOKEN:
    #     required: true
    # inputs:
    #   branch:
    #     description: 'Rama a analizar (por defecto: qa)'
    #     required: false
    #     type: string
    #     default: 'qa'

# 🔐 Permisos mínimos requeridos
permissions:
  actions: read
  contents: read
  security-events: write

jobs:
  # ═══════════════════════════════════════════════════════════
  # 🔧 JOB: INTEGRATION SETUP
  # ═══════════════════════════════════════════════════════════
  integration:
    name: 🧩 Setup de Integración
    runs-on: ubuntu-latest

    steps:
      - name: 📦 Checkout del código
        uses: actions/checkout@v4

      - name: 🧰 Preparar entorno
        run: echo "Configurando entorno base para pruebas de integración..."

  # ═══════════════════════════════════════════════════════════
  # 🧩 JOB: TEST UNITARIOS
  # ═══════════════════════════════════════════════════════════
  test-unit:
    name: 🧪 Unit Tests
    runs-on: ubuntu-latest

    steps:
      - name: 📦 Checkout del código
        uses: actions/checkout@v4

      - name: ⚙️ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: 📥 Instalar dependencias
        run: |
          pip install flask pytest

      - name: ▶️ Ejecutar tests unitarios
        run: pytest -v

  # ═══════════════════════════════════════════════════════════
  # 🔗 JOB: TEST DE INTEGRACIÓN
  # ═══════════════════════════════════════════════════════════
  test-integration:
    name: 🔗 Integration Tests
    runs-on: ubuntu-latest
    needs: test-unit

    steps:
      - name: 📦 Checkout del código
        uses: actions/checkout@v4

      - name: 🧩 Ejecutar pruebas de integración
        run: echo "Comprueba que cada función o módulo funciona correctamente en conjunto"
