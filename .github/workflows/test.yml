########################################
# ğŸ§ª WORKFLOW REUSABLE: Date Workflow
# Ejecuta pruebas unitarias, de integraciÃ³n, lint y anÃ¡lisis de calidad.
# Pensado para reutilizar en pipelines automatizados.
########################################

name: Reusable Date Workflow

# ğŸ”§ Definir como workflow reusable
on:
  workflow_call:
    secrets:
      EXTERNAL_REPO_TOKEN: 
        required: true
        description: 'Token para acceder al repositorio app'

permissions:
  actions: read
  contents: read

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ§© JOB: TEST UNITARIOS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-unit:
    name: ğŸ§ª Unit Tests
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Clonar el repositorio app
        uses: actions/checkout@v4
        with:
          repository: dariasmoises979-blip/app
          ref: main
          token: ${{ secrets.EXTERNAL_REPO_TOKEN }}

      - name: âš™ï¸ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: ğŸ“¥ Instalar dependencias
        run: |
          pip install flask pytest

      - name: â–¶ï¸ Ejecutar tests unitarios
        run: pytest -v

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ”— JOB: TEST DE INTEGRACIÃ“N
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-integration:
    name: ğŸ”— Integration Tests
    runs-on: ubuntu-latest
    needs: test-unit

    steps:
      - name: ğŸ”„ Clonar el repositorio app
        uses: actions/checkout@v4
        with:
          repository: dariasmoises979-blip/app
          ref: main
          token: ${{ secrets.EXTERNAL_REPO_TOKEN }}

      - name: ğŸ§© Ejecutar pruebas de integraciÃ³n
        run: echo "Comprueba que cada funciÃ³n o mÃ³dulo funciona correctamente en conjunto"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ§¹ JOB: LINTER Y ANÃLISIS DE ESTILO
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-lint:
    name: ğŸ§¹ Lint & Style Check
    runs-on: ubuntu-latest
    needs: test-integration

    steps:
      - name: ğŸ”„ Clonar el repositorio app
        uses: actions/checkout@v4
        with:
          repository: dariasmoises979-blip/app
          ref: main
          token: ${{ secrets.APP_REPO_TOKEN }}

      - name: ğŸ” Ejecutar anÃ¡lisis de estilo
        run: echo "Control de estilo y detecciÃ³n de errores comunes"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“Š JOB: ANÃLISIS DE CALIDAD (SONARCLOUD)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  sonarcloud:
    name: ğŸ“Š SonarCloud Analysis
    runs-on: ubuntu-latest
    needs: test-lint

    steps:
      - name: ğŸ”„ Clonar el repositorio app
        uses: actions/checkout@v4
        with:
          repository: dariasmoises979-blip/app
          ref: main
          token: ${{ secrets.GH2_TOKEN }}

      - name: ğŸ” Ejecutar anÃ¡lisis de SonarCloud
        run: echo "DetecciÃ³n temprana de errores y malas prÃ¡cticas en el cÃ³digo"