# ==========================================================
# 🧭 Despliegue de n8n en entorno QA / staging
# ==========================================================
# Archivo: values-staging.yaml
# Descripción:
#   Este archivo define la configuración de n8n para entorno
#   de pruebas o integración (QA / staging).
#
# Variables principales:
#   - global.image.repository / tag
#   - server.service.type
#   - server.ingress.*: configuración del Ingress público
#   - env.*: variables de entorno incluyendo credenciales y DB
#   - resources.*: recursos asignados
#
# Requisitos:
#   - Clúster Kubernetes con ingress (Nginx u otro)
#   - Secretos de autenticación y base de datos
# ==========================================================

global:
  image:
    repository: n8nio/n8n
    tag: 1.67.0

server:
  service:
    type: ClusterIP
    port: 5678

  # Ingress habilitado para staging
  ingress:
    enabled: true
    ingressClassName: "nginx"
    hosts:
      - host: n8n-staging.midominio.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
          - n8n-staging.midominio.com
        secretName: n8n-staging-tls

configs:
  params:
    N8N_BASIC_AUTH_ACTIVE: "true"
    N8N_BASIC_AUTH_USER: "user-staging"          # Se recomienda usar secretKeyRef
    N8N_BASIC_AUTH_PASSWORD: "password-staging"  # Se recomienda usar secretKeyRef
    GENERIC_TIMEZONE: "Europe/Madrid"
    EXECUTIONS_DATA_SAVE_ON_ERROR: "all"
    DB_TYPE: "postgresdb"
    DB_POSTGRESDB_HOST: "postgres-staging"
    DB_POSTGRESDB_DATABASE: "n8n"
    DB_POSTGRESDB_USER: "n8nuser"
    DB_POSTGRESDB_PASSWORD: "n8npassword"

resources:
  requests:
    cpu: "500m"
    memory: "512Mi"
  limits:
    cpu: "1000m"
    memory: "1Gi"
